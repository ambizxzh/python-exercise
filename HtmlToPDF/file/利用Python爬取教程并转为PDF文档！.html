<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="article-holder"><p>作为一名程序员，经常要搜一些教程，有的教程是在线的，不提供离线版本，这就有些局限了。那么同样作为一名程序员，遇到问题就应该解决它，今天就来将在线教程保存为PDF以供查阅。</p><p>1、网站介绍</p><p>2、准备工作</p><p>2.1 软件安装</p><p>2.2 库安装</p><p>3、爬取内容</p><p>3.1 获取教程名称</p><p>3.2 获取目录及对应网址</p><p>3.3 获取章节内容</p><p>3.4 保存pdf</p><p>3.5 合并pdf</p><h1>1、网站介绍</h1><p>之前再搜资料的时候经常会跳转到如下图所示的在线教程：</p><figure contenteditable="false" class="img-box"><img src="https://i0.hdslb.com/bfs/article/e2a12ec3e0e48c45795449b875d1925309161db4.png" alt="image" data-size="233657" width="658" height="491"><figcaption class="caption" contenteditable=""></figcaption></figure><p>包括一些github的项目也纷纷将教程链接指向这个网站。经过一番查找，该网站是一个可以创建、托管和浏览文档的网站，其网址为：https://readthedocs.org 。在上面可以找到很多优质的资源。</p><p><br></p><p>该网站虽然提供了下载功能，但是有些教程并没有提供PDF格式文件的下载，如图：</p><figure contenteditable="false" class="img-box"><img src="https://i0.hdslb.com/bfs/article/3d63719f2fb1d4deaf0c84845d81802608c6ddde.png" alt="image" data-size="72305" width="297" height="381"><figcaption class="caption" contenteditable=""></figcaption></figure><p>该教程只提供了 HTML格式文件的下载，还是不太方便查阅，那就让我们动手将其转成PDF吧！</p><p><br></p><h1>2、准备工作</h1><h1>2.1 软件安装</h1><p>由于我们是要把html转为pdf，所以需要手动<strong>wkhtmltopdf</strong> 。Windows平台直接在 http://wkhtmltopdf.org/downloads.html 下载稳定版的 wkhtmltopdf 进行安装，安装完成之后把该程序的执行路径加入到系统环境 $PATH 变量中，否则 pdfkit 找不到 wkhtmltopdf 就出现错误 “No wkhtmltopdf executable found”。Ubuntu 和 CentOS 可以直接用命令行进行安装</p><p></p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/b929df356ee12790b6c8e0ceae4bec7b52c8e6a5.png" width="499" height="58" data-size="7188"><figcaption class="caption" contenteditable=""></figcaption></figure><p><code> </code><br></p><h1>2.2 库安装</h1><ul class=" list-paddingleft-2"><li><p>pip install requests # 用于网络请求</p></li><li><p>pip install beautifulsoup4 # 用于操作html</p></li><li><p>pip install pdfkit # wkhtmltopdf 的Python封装包</p></li><li><p>pip install PyPDF2 # 用于合并pdf</p></li></ul><h1>3、爬取内容</h1><p>本文的目标网址为：http://python3-cookbook.readthedocs.io/zh_CN/latest/ 。</p><h1>3.1 获取教程名称</h1><p>页面的左边一栏为目录，按F12调出开发者工具并按以下步骤定位到目录元素：</p><p>① 点击开发者工具左上角"<strong>选取页面元素</strong>"按钮；</p><p>② 用鼠标点击左上角教程名称处。</p><p>通过以上步骤即可定位到目录元素，用图说明：</p><figure contenteditable="false" class="img-box"><img src="https://i0.hdslb.com/bfs/article/acb4b41f43793a0b5ce7fb77e1395b6c54fd7581.png" alt="image" data-size="223477" width="663" height="307"><figcaption class="caption" contenteditable=""></figcaption></figure><p>从图看到我们需要的教程名称包含在<code>&lt;div&gt;&lt;/div&gt;</code>之间的<code>a</code>标签里。假设我们已经获取到了网页内容为html，可以使用以下代码获取该内容：</p><p><br></p><p></p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/c2d2c8b26afaa514fae72943708d26eaa90d8e1f.png" width="504" height="38" data-size="5462"><figcaption class="caption" contenteditable=""></figcaption></figure><p><code> </code><br></p><h1>3.2 获取目录及对应网址</h1><p>使用与 2.1 相同的步骤来获取：</p><figure contenteditable="false" class="img-box"><img src="https://i0.hdslb.com/bfs/article/98880e54c03514b692a89848485ce1110855b2b4.png" alt="image" data-size="258034" width="657" height="421"><figcaption class="caption" contenteditable=""></figcaption></figure><p>从图看到我们需要的目录包含在<code>&lt;div&gt;&lt;/div&gt;</code>之间，<code>&lt;li&gt;&lt;/li&gt;</code>标签里为一级目录及网址；<code>&lt;li&gt;&lt;/li&gt;</code>标签里为二级目录及网址。当然这个url是相对的url，前面还要拼接<code>http://python3-cookbook.readthedocs.io/zh_CN/latest/</code>。</p><p><br></p><p>使用BeautifulSoup进行数据的提取：</p><p></p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/86517cbadc2c317e79371fda6fce18fbef0adc6c.png" width="504" height="526" data-size="50174"><figcaption class="caption" contenteditable=""></figcaption></figure><p><br></p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/368ffc69f432573cde4da342e56c323d42d418ba.png" width="502" height="303" data-size="29183"><figcaption class="caption" contenteditable=""></figcaption></figure><p><code> </code><br></p><p>代码中定义了两个全局变量来保存信息。章节内容保存在<strong>chapter_info</strong>列表里，里面包含了层级结构，大致结构为：</p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/6360e48a09bde17a8eb73ba95d290cf09c0a596e.png" width="499" height="309" data-size="13436"><figcaption class="caption" contenteditable=""></figcaption></figure><p>3.3 获取章节内容</p><p>还是同样的方法定位章节内容：</p><p><br></p><figure contenteditable="false" class="img-box"><img src="https://i0.hdslb.com/bfs/article/dffe1bd2a49da64c8eb21634dd354a50d334fd35.png" alt="image" data-size="322613" width="648" height="441"><figcaption class="caption" contenteditable=""></figcaption></figure><p>05.获取章节内容</p><p><br></p><p>代码中我们通过<code>itemprop</code>这个属性来定位，好在一级目录内容的元素位置和二级目录内容的元素位置相同，省去了不少麻烦。</p><p></p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/811bcda79386f82577142b99ca3063551e9e3403.png" width="496" height="493" data-size="35780"><figcaption class="caption" contenteditable=""></figcaption></figure><p><code> </code><br></p><h1>3.4 保存pdf</h1><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/644980da2470069dc3cfe22115e75b3125797ed3.png" width="494" height="554" data-size="41197"><figcaption class="caption" contenteditable=""></figcaption></figure><p><br></p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/0b2aa4638b6ca5b8ceb18e454064901be1a8ef93.png" width="500" height="596" data-size="51300"><figcaption class="caption" contenteditable=""></figcaption></figure><p>3.5 合并pdf<br></p><p>经过上一步，所有章节的pdf都保存下来了，最后我们希望留一个pdf，就需要合并所有pdf并删除单个章节pdf。</p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/cbc43d7b65c8133386600087c7cd2710fec3db72.png" width="503" height="678" data-size="58549"><figcaption class="caption" contenteditable=""></figcaption></figure><p><br></p><figure class="img-box" contenteditable="false"><img src="https://i0.hdslb.com/bfs/article/776436f3ce117b03091524f64f8e8e32debbda6d.png" width="497" height="481" data-size="47428"><figcaption class="caption" contenteditable=""></figcaption></figure><p>本来PyPDF2库中有一个类<code>PdfFileMerger</code>专门用来合并pdf，但是在合并过程中会抛出异常，网上有人也遇到同样的问题，解决办法是修改库源码，本着“不动库源码”的理念，毅然选择了上面这种比较笨的办法，代码还是比较好理解的。<br></p><p>经过以上几个步骤，我们想要的pdf文件已经生成，一起来欣赏一下劳动成果：</p><figure contenteditable="false" class="img-box"><img src="https://i0.hdslb.com/bfs/article/01edab250ed1249e7918941058747c2e48426b0a.png" alt="image" data-size="251947" width="687" height="526"><figcaption class="caption" contenteditable=""></figcaption></figure><p><br></p></div>
</body>
</html>